<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>标准日语 初级上册 - 第一课</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP&family=Noto+Sans+SC&display=swap" rel="stylesheet">
    
    <!-- ...existing styles... -->
    
    <style>
        /* 新增在线音频播放相关样式 */
        .online-audio-container {
            position: relative;
            display: inline-block;
        }
        
        .audio-player-mini {
            width: 0;
            height: 0;
            opacity: 0;
            position: absolute;
            pointer-events: none;
        }
        
        .tts-iframe {
            width: 1px;
            height: 1px;
            border: none;
            position: absolute;
            left: -9999px;
            top: -9999px;
        }
        
        .backup-audio-panel {
            position: fixed;
            bottom: 20px;
            left: 20px;
            right: 20px;
            background: rgba(0,0,0,0.9);
            color: white;
            padding: 15px;
            border-radius: 10px;
            z-index: 2000;
            display: none;
            backdrop-filter: blur(10px);
        }
        
        .backup-audio-panel.show {
            display: block;
            animation: slideUp 0.3s ease;
        }
        
        .backup-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 10px;
            margin: 10px 0;
        }
        
        .backup-option {
            background: #007acc;
            color: white;
            border: none;
            padding: 10px 8px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 11px;
            text-align: center;
            transition: all 0.2s ease;
        }
        
        .backup-option:hover {
            background: #005c99;
            transform: translateY(-1px);
        }
        
        .backup-option:active {
            transform: translateY(0);
        }
        
        @keyframes slideUp {
            from { transform: translateY(100%); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        /* 改进现有样式 */
        .audio-button {
            background: linear-gradient(145deg, #007acc, #005c99);
            color: white;
            border: none;
            border-radius: 6px;
            padding: 6px 10px;
            margin-left: 8px;
            cursor: pointer;
            font-size: 12px;
            vertical-align: middle;
            min-width: 35px;
            position: relative;
            box-shadow: 0 2px 4px rgba(0,122,204,0.3);
            transition: all 0.2s ease;
        }
        
        .audio-button:hover {
            background: linear-gradient(145deg, #005c99, #004d80);
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0,122,204,0.4);
        }
        
        .audio-button.playing {
            background: linear-gradient(145deg, #28a745, #1e7e34);
            animation: glow 1s infinite alternate;
        }
        
        .audio-button.loading {
            background: linear-gradient(145deg, #ffc107, #e0a800);
            animation: pulse 1s infinite;
        }
        
        .audio-button.error {
            background: linear-gradient(145deg, #dc3545, #c82333);
        }
        
        .audio-button.success {
            background: linear-gradient(145deg, #28a745, #1e7e34);
        }
        
        .audio-test-panel {
            position: fixed;
            top: 15px;
            right: 15px;
            background: rgba(33,37,41,0.95);
            color: white;
            padding: 15px;
            border-radius: 10px;
            font-size: 12px;
            z-index: 1000;
            max-width: 320px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.1);
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
            display: none;
        }
        .audio-test-panel.show {
            display: block;
            animation: slideIn 0.4s ease;
        }
        .test-panel-header {
            font-weight: 700;
            margin-bottom: 10px;
            color: #4fc3f7;
        }
        .test-panel-item {
            margin: 8px 0;
            padding: 6px 10px;
            background: rgba(255,255,255,0.1);
            border-radius: 4px;
            display: flex;
            justify-content: space-between;
        }
        .status-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 6px;
        }
        .status-indicator.online { background: #4caf50; }
        .status-indicator.offline { background: #f44336; }
        .status-indicator.loading { background: #ff9800; animation: pulse 1s infinite; }
        
        /* ...existing styles... */
    </style>
</head>
<body>
    <!-- 音频测试面板 -->
    <div id="audioTestPanel" class="audio-test-panel">
        <div class="test-panel-header">🔊 音频系统状态</div>
        <div class="test-panel-item">
            <span>本地语音:</span>
            <span id="localStatus"><span class="status-indicator loading"></span>检测中</span>
        </div>
        <div class="test-panel-item">
            <span>在线TTS:</span>
            <span id="onlineStatus"><span class="status-indicator loading"></span>检测中</span>
        </div>
        <div class="test-panel-item">
            <span>推荐方案:</span>
            <span id="recommendedMethod"><span class="status-indicator loading"></span>分析中</span>
        </div>
    </div>

    <div class="container">
        <header>
            <h1>标准日语 初级上册 Pro</h1>
            <h2>第一课：はじめまして</h2>
            <h3>初次见面</h3>
        </header>

        <div class="lesson-navigation">
            <a href="index.html" class="nav-home" title="返回目录"><i class="nav-icon">🏠</i><span>目录</span></a>
            <a href="#" class="nav-prev" title="没有上一课" style="visibility: hidden;"><i class="nav-icon">◀</i><span>上一课</span></a>
            <a href="lesson2.html" class="nav-next" title="下一课：これは本です"><i class="nav-icon">▶</i><span>下一课</span></a>
        </div>

        <section class="dialogue">
            <h3>会話（かいわ）- 对话</h3>
            <div class="dialogue-container">
                <div class="dialogue-scene">
                    <p class="scene-description">（李さんは森さんの研究室を訪ねます）</p>
                    <p class="scene-description-cn">（小李拜访森老师的研究室）</p>
                </div>
                
                <div class="dialogue-line">
                    <p class="speaker">李：</p>
                    <div class="speech">
                        <p class="japanese speech-text">すみません。
                            <div class="online-audio-container">
                                <button class="audio-button" data-text="すみません">🔊</button>
                                <audio class="audio-player-mini" preload="none"></audio>
                            </div>
                        </p>
                        <p class="kana">すみません。</p>
                        <p class="romaji">Sumimasen.</p>
                        <p class="chinese">打扰了。</p>
                    </div>
                </div>

                <div class="dialogue-line">
                    <p class="speaker">森：</p>
                    <div class="speech">
                        <p class="japanese speech-text">はい、どうぞ。
                            <div class="online-audio-container">
                                <button class="audio-button" data-text="はい、どうぞ">🔊</button>
                                <audio class="audio-player-mini" preload="none"></audio>
                            </div>
                        </p>
                        <p class="kana">はい、どうぞ。</p>
                        <p class="romaji">Hai, douzo.</p>
                        <p class="chinese">请进。</p>
                    </div>
                </div>
                
                <div class="dialogue-line">
                    <p class="speaker">李：</p>
                    <div class="speech">
                        <p class="japanese speech-text">はじめまして。中国から来ました李です。どうぞよろしくお願いします。
                            <button class="audio-button" onclick="playJapanese('はじめまして。中国から来ました李です。どうぞよろしくお願いします')">🔊</button>
                        </p>
                        <p class="kana">はじめまして。ちゅうごくから きました り です。どうぞよろしく おねがいします。</p>
                        <p class="romaji">Hajimemashite. Chūgoku kara kimashita Ri desu. Douzo yoroshiku onegaishimasu.</p>
                        <p class="chinese">初次见面。我是来自中国的小李。请多多关照。</p>
                    </div>
                </div>
                
                <div class="dialogue-line">
                    <p class="speaker">森：</p>
                    <div class="speech">
                        <p class="japanese speech-text">はじめまして。森です。どうぞよろしく。
                            <button class="audio-button" onclick="playJapanese('はじめまして。森です。どうぞよろしく')">🔊</button>
                        </p>
                        <p class="kana">はじめまして。もり です。どうぞよろしく。</p>
                        <p class="romaji">Hajimemashite. Mori desu. Douzo yoroshiku.</p>
                        <p class="chinese">初次见面。我是森。请多关照。</p>
                    </div>
                </div>

                <div class="dialogue-line">
                    <p class="speaker">李：</p>
                    <div class="speech">
                        <p class="japanese speech-text">日本語を勉強しています。
                            <button class="audio-button" onclick="playJapanese('日本語を勉強しています')">🔊</button>
                        </p>
                        <p class="kana">にほんごを べんきょうしています。</p>
                        <p class="romaji">Nihongo o benkyō shite imasu.</p>
                        <p class="chinese">我正在学习日语。</p>
                    </div>
                </div>

                <div class="dialogue-line">
                    <p class="speaker">森：</p>
                    <div class="speech">
                        <p class="japanese speech-text">そうですか。頑張ってください。
                            <button class="audio-button" onclick="playJapanese('そうですか。頑張ってください')">🔊</button>
                        </p>
                        <p class="kana">そうですか。がんばってください。</p>
                        <p class="romaji">Sō desu ka. Ganbatte kudasai.</p>
                        <p class="chinese">是吗？请加油。</p>
                    </div>
                </div>

                <div class="dialogue-line">
                    <p class="speaker">李：</p>
                    <div class="speech">
                        <p class="japanese speech-text">ありがとうございます。
                            <button class="audio-button" onclick="playJapanese('ありがとうございます')">🔊</button>
                        </p>
                        <p class="kana">ありがとうございます。</p>
                        <p class="romaji">Arigatou gozaimasu.</p>
                        <p class="chinese">谢谢您。</p>
                    </div>
                </div>
            </div>
        </section>

        <section class="vocabulary">
            <h3>単語（たんご）- 单词</h3>
            
            <!-- 音频控制面板 -->
            <div class="speech-controls">
                <div class="control-group">
                    <label>🔊 音频:</label>
                    <span id="currentAudioStatus" class="audio-status loading">初始化中...</span>
                </div>
                <div class="control-group">
                    <label>语速:</label>
                    <select id="speechRate">
                        <option value="0.6">很慢</option>
                        <option value="0.8" selected>正常</option>
                        <option value="1.0">快速</option>
                    </select>
                </div>
                <div class="control-group">
                    <label>播放方式:</label>
                    <select id="audioMethod">
                        <option value="auto">智能选择</option>
                        <option value="local">本地语音</option>
                        <option value="online">在线语音</option>
                        <option value="manual">手动播放</option>
                        <option value="guide">发音指导</option>
                    </select>
                </div>
                <div class="control-group">
                    <button onclick="testAudioSystem()">🧪 测试音频</button>
                    <button onclick="showAudioHelp()">❓ 帮助</button>
                </div>
            </div>

            <!-- 手动音频面板 -->
            <div id="manualAudioPanel" class="manual-audio-panel">
                <h4 style="margin: 0 0 10px 0; color: #1976d2;">🎵 请选择播放方式</h4>
                <div class="audio-options">
                    <div class="audio-option" onclick="openGoogleTranslate()">
                        <span class="option-icon">🌐</span>
                        <div class="option-title">Google翻译</div>
                        <div class="option-desc">最准确的日语发音</div>
                    </div>
                    <div class="audio-option" onclick="openBingTranslator()">
                        <span class="option-icon">🔊</span>
                        <div class="option-title">必应翻译</div>
                        <div class="option-desc">微软语音引擎</div>
                    </div>
                    <div class="audio-option" onclick="openYoudaoTranslate()">
                        <span class="option-icon">📱</span>
                        <div class="option-title">有道翻译</div>
                        <div class="option-desc">国内稳定访问</div>
                    </div>
                    <div class="audio-option" onclick="showPronunciationGuide()">
                        <span class="option-icon">📖</span>
                        <div class="option-title">发音指导</div>
                        <div class="option-desc">文字发音说明</div>
                    </div>
                </div>
                <div style="text-align: center; margin-top: 10px;">
                    <button onclick="hideManualPanel()" style="background: #6c757d; color: white; border: none; padding: 5px 15px; border-radius: 4px; cursor: pointer;">关闭面板</button>
                </div>
            </div>

            <!-- 发音指导面板 -->
            <div id="pronunciationPanel" class="pronunciation-guide">
                <div class="guide-header">
                    <div class="guide-title">
                        <span>🎌</span>
                        <span>日语发音指导</span>
                    </div>
                    <button class="close-btn" onclick="hidePronunciationGuide()">✕</button>
                </div>
                <div class="guide-content" id="guideContent">
                    <!-- 动态内容 -->
                </div>
            </div>

            <table>
                <thead>
                    <tr>
                        <th>日语</th>
                        <th>假名</th>
                        <th>罗马音</th>
                        <th>中文</th>
                        <th>发音</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><span class="word-text">はじめまして</span></td>
                        <td>はじめまして</td>
                        <td>hajimemashite</td>
                        <td>初次见面</td>
                        <td>
                            <div class="online-audio-container">
                                <button class="audio-button" data-text="はじめまして">🔊</button>
                                <audio class="audio-player-mini" preload="none"></audio>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td><span class="word-text">すみません</span></td>
                        <td>すみません</td>
                        <td>sumimasen</td>
                        <td>打扰了、对不起</td>
                        <td>
                            <div class="online-audio-container">
                                <button class="audio-button" data-text="すみません">🔊</button>
                                <audio class="audio-player-mini" preload="none"></audio>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td><span class="word-text">はい</span></td>
                        <td>はい</td>
                        <td>hai</td>
                        <td>是、好的</td>
                        <td><button class="audio-button" data-text="はい">🔊</button></td>
                    </tr>
                    <tr>
                        <td><span class="word-text">どうぞ</span></td>
                        <td>どうぞ</td>
                        <td>douzo</td>
                        <td>请</td>
                        <td><button class="audio-button" data-text="どうぞ">🔊</button></td>
                    </tr>
                    <tr>
                        <td><span class="word-text">中国</span></td>
                        <td>ちゅうごく</td>
                        <td>chūgoku</td>
                        <td>中国</td>
                        <td><button class="audio-button" data-text="中国">🔊</button></td>
                    </tr>
                    <tr>
                        <td><span class="word-text">から</span></td>
                        <td>から</td>
                        <td>kara</td>
                        <td>从...（助词）</td>
                        <td><button class="audio-button" data-text="から">🔊</button></td>
                    </tr>
                    <tr>
                        <td><span class="word-text">来ました</span></td>
                        <td>きました</td>
                        <td>kimashita</td>
                        <td>来了（动词"来"的过去式）</td>
                        <td><button class="audio-button" data-text="来ました">🔊</button></td>
                    </tr>
                    <tr>
                        <td><span class="word-text">です</span></td>
                        <td>です</td>
                        <td>desu</td>
                        <td>是（助动词）</td>
                        <td><button class="audio-button" data-text="です">🔊</button></td>
                    </tr>
                    <tr>
                        <td><span class="word-text">よろしく</span></td>
                        <td>よろしく</td>
                        <td>yoroshiku</td>
                        <td>请多关照</td>
                        <td><button class="audio-button" data-text="よろしく">🔊</button></td>
                    </tr>
                    <tr>
                        <td><span class="word-text">お願いします</span></td>
                        <td>おねがいします</td>
                        <td>onegaishimasu</td>
                        <td>拜托了</td>
                        <td><button class="audio-button" data-text="お願いします">🔊</button></td>
                    </tr>
                    <tr>
                        <td><span class="word-text">日本語</span></td>
                        <td>にほんご</td>
                        <td>nihongo</td>
                        <td>日语</td>
                        <td><button class="audio-button" data-text="日本語">🔊</button></td>
                    </tr>
                    <tr>
                        <td><span class="word-text">を</span></td>
                        <td>を</td>
                        <td>o</td>
                        <td>（助词，表示动作的对象）</td>
                        <td><button class="audio-button" data-text="を">🔊</button></td>
                    </tr>
                    <tr>
                        <td><span class="word-text">勉強しています</span></td>
                        <td>べんきょうしています</td>
                        <td>benkyō shite imasu</td>
                        <td>正在学习</td>
                        <td><button class="audio-button" data-text="勉強しています">🔊</button></td>
                    </tr>
                    <tr>
                        <td><span class="word-text">そうですか</span></td>
                        <td>そうですか</td>
                        <td>sō desu ka</td>
                        <td>是吗？</td>
                        <td><button class="audio-button" data-text="そうですか">🔊</button></td>
                    </tr>
                    <tr>
                        <td><span class="word-text">頑張ってください</span></td>
                        <td>がんばってください</td>
                        <td>ganbatte kudasai</td>
                        <td>请加油</td>
                        <td><button class="audio-button" data-text="頑張ってください">🔊</button></td>
                    </tr>
                    <tr>
                        <td><span class="word-text">ありがとうございます</span></td>
                        <td>ありがとうございます</td>
                        <td>arigatou gozaimasu</td>
                        <td>谢谢</td>
                        <td><button class="audio-button" data-text="ありがとうございます">🔊</button></td>
                    </tr>
                </tbody>
            </table>
        </section>

        <section class="grammar-points">
            <h3>文法（ぶんぽう）- 语法</h3>
            <div class="grammar-point">
                <h4>1. 「AはBです」句型</h4>
                <p>表示"A是B"的意思，是最基本的判断句型。</p>
                <div class="example">
                    <p class="japanese speech-text">私は李です。
                        <button class="audio-button" onclick="playJapanese('私は李です')">🔊</button>
                    </p>
                    <p class="kana">わたしは り です。</p>
                    <p class="romaji">Watashi wa Ri desu.</p>
                    <p class="chinese">我是李。</p>
                </div>
                <div class="example">
                    <p class="japanese speech-text">これは本です。
                        <button class="audio-button" onclick="playJapanese('これは本です')">🔊</button>
                    </p>
                    <p class="kana">これは ほん です。</p>
                    <p class="romaji">Kore wa hon desu.</p>
                    <p class="chinese">这是书。</p>
                </div>
            </div>

            <div class="grammar-point">
                <h4>2. 「どうぞよろしくお願いします」表达</h4>
                <p>是一种在初次见面时表达"请多关照"的礼貌用语。</p>
                <div class="example">
                    <p class="japanese speech-text">どうぞよろしくお願いします。
                        <button class="audio-button" onclick="playJapanese('どうぞよろしくお願いします')">🔊</button>
                    </p>
                    <p class="kana">どうぞよろしく おねがいします。</p>
                    <p class="romaji">Douzo yoroshiku onegaishimasu.</p>
                    <p class="chinese">请多多关照。</p>
                </div>
                <div class="note">
                    <p>也可以简化为「どうぞよろしく」，稍微不那么正式。</p>
                </div>
            </div>

            <div class="grammar-point">
                <h4>3. 「～から来ました」句型</h4>
                <p>表示"从...来"，说明出发点或来源。</p>
                <div class="example">
                    <p class="japanese speech-text">中国から来ました。</p>
                    <p class="kana">ちゅうごくから きました。</p>
                    <p class="romaji">Chūgoku kara kimashita.</p>
                    <p class="chinese">我来自中国。</p>
                </div>
                <div class="example">
                    <p class="japanese speech-text">東京から来ました。</p>
                    <p class="kana">とうきょうから きました。</p>
                    <p class="romaji">Tōkyō kara kimashita.</p>
                    <p class="chinese">我来自东京。</p>
                </div>
            </div>

            <div class="grammar-point">
                <h4>4. 「～を勉強しています」句型</h4>
                <p>表示"正在学习...", 使用进行时态。</p>
                <div class="example">
                    <p class="japanese speech-text">日本語を勉強しています。</p>
                    <p class="kana">にほんごを べんきょうしています。</p>
                    <p class="romaji">Nihongo o benkyō shite imasu.</p>
                    <p class="chinese">我正在学习日语。</p>
                </div>
                <div class="example">
                    <p class="japanese speech-text">歴史を勉強しています。</p>
                    <p class="kana">れきしを べんきょうしています。</p>
                    <p class="romaji">Rekishi o benkyō shite imasu.</p>
                    <p class="chinese">我正在学习历史。</p>
                </div>
            </div>
        </section>

        <section class="example-sentences">
            <h3>応用例文（おうようれいぶん）- 应用例句</h3>
            <div class="example">
                <p class="japanese speech-text">私は王です。中国から来ました。</p>
                <p class="kana">わたしは おう です。ちゅうごくから きました。</p>
                <p class="romaji">Watashi wa Wang desu. Chūgoku kara kimashita.</p>
                <p class="chinese">我是王。我来自中国。</p>
            </div>
            <div class="example">
                <p class="japanese speech-text">田中さんは学生です。</p>
                <p class="kana">たなかさんは がくせい です。</p>
                <p class="romaji">Tanaka-san wa gakusei desu.</p>
                <p class="chinese">田中先生是学生。</p>
            </div>
            <div class="example">
                <p class="japanese speech-text">あなたは日本人ですか。</p>
                <p class="kana">あなたは にほんじん ですか。</p>
                <p class="romaji">Anata wa nihonjin desu ka.</p>
                <p class="chinese">你是日本人吗？</p>
            </div>
            <div class="example">
                <p class="japanese speech-text">はい、私は日本人です。</p>
                <p class="kana">はい、わたしは にほんじん です。</p>
                <p class="romaji">Hai, watashi wa nihonjin desu.</p>
                <p class="chinese">是的，我是日本人。</p>
            </div>
        </section>

        <section class="exam-practice">
            <h3>日语能力测试 N5 真题练习</h3>
            <p class="section-intro">以下是与第一课相关的N5水平考试真题，练习后可以点击查看答案。</p>
            
            <div class="exam-section vocabulary-test">
                <h4>单词部分</h4>
                
                <div class="question">
                    <p class="question-number">1.</p>
                    <p class="question-text">「はじめまして」の意味は何ですか。</p>
                    <div class="options">
                        <p>A. 你好</p>
                        <p>B. 初次见面</p>
                        <p>C. 谢谢</p>
                        <p>D. 再见</p>
                    </div>
                    <button class="toggle-answer">显示答案</button>
                    <div class="answer-section">
                        <p class="answer">正确答案：B. 初次见面</p>
                        <p class="explanation">「はじめまして」是在第一次见面时使用的问候语，相当于汉语中的"初次见面"。</p>
                    </div>
                </div>
                
                <div class="question">
                    <p class="question-number">2.</p>
                    <p class="question-text">次の言葉の読み方として正しいものはどれですか。「日本語」</p>
                    <div class="options">
                        <p>A. にっぽんご</p>
                        <p>B. にほんごご</p>
                        <p>C. にほんご</p>
                        <p>D. にっぽんごご</p>
                    </div>
                    <button class="toggle-answer">显示答案</button>
                    <div class="answer-section">
                        <p class="answer">正确答案：C. にほんご</p>
                        <p class="explanation">「日本語」的正确读法是「にほんご」(nihongo)，表示"日语"。</p>
                    </div>
                </div>
            </div>
            
            <div class="exam-section grammar-test">
                <h4>语法部分</h4>
                
                <div class="question">
                    <p class="question-number">3.</p>
                    <p class="question-text">わたし（　　）学生です。</p>
                    <div class="options">
                        <p>A. を</p>
                        <p>B. は</p>
                        <p>C. が</p>
                        <p>D. に</p>
                    </div>
                    <button class="toggle-answer">显示答案</button>
                    <div class="answer-section">
                        <p class="answer">正确答案：B. は</p>
                        <p class="explanation">「AはBです」是表示"A是B"的基本句型，其中「は」是提示主题的助词。</p>
                    </div>
                </div>
                
                <div class="question">
                    <p class="question-number">4.</p>
                    <p class="question-text">李さんは中国（　　）来ました。</p>
                    <div class="options">
                        <p>A. を</p>
                        <p>B. は</p>
                        <p>C. から</p>
                        <p>D. に</p>
                    </div>
                    <button class="toggle-answer">显示答案</button>
                    <div class="answer-section">
                        <p class="answer">正确答案：C. から</p>
                        <p class="explanation">「から」表示出发点或来源，在此句中表示"从中国来"。</p>
                    </div>
                </div>
            </div>
            
            <div class="exam-section reading-test">
                <h4>阅读理解部分</h4>
                
                <div class="reading-passage">
                    <p>田中：はじめまして。田中です。</p>
                    <p>王：はじめまして。王です。中国から来ました。</p>
                    <p>田中：王さんは学生ですか。</p>
                    <p>王：はい、そうです。日本語を勉強しています。</p>
                    <p>田中：そうですか。私も中国語を勉強しています。どうぞよろしく。</p>
                    <p>王：こちらこそ、よろしくお願いします。</p>
                </div>
                
                <div class="question">
                    <p class="question-number">5.</p>
                    <p class="question-text">王さんはどこから来ましたか。</p>
                    <div class="options">
                        <p>A. 日本</p>
                        <p>B. アメリカ</p>
                        <p>C. 中国</p>
                        <p>D. 韓国</p>
                    </div>
                    <button class="toggle-answer">显示答案</button>
                    <div class="answer-section">
                        <p class="answer">正确答案：C. 中国</p>
                        <p class="explanation">对话中王说「中国から来ました」，表明他来自中国。</p>
                    </div>
                </div>
                
                <div class="question">
                    <p class="question-number">6.</p>
                    <p class="question-text">田中さんは何を勉強していますか。</p>
                    <div class="options">
                        <p>A. 英語</p>
                        <p>B. 中国語</p>
                        <p>C. 日本語</p>
                        <p>D. 韓国語</p>
                    </div>
                    <button class="toggle-answer">显示答案</button>
                    <div class="answer-section">
                        <p class="answer">正确答案：B. 中国語</p>
                        <p class="explanation">对话中田中说「私も中国語を勉強しています」，表明他在学习中文。</p>
                    </div>
                </div>
                
                <div class="question">
                    <p class="question-number">7.</p>
                    <p class="question-text">王さんは何をしていますか。</p>
                    <div class="options">
                        <p>A. 先生です</p>
                        <p>B. 会社員です</p>
                        <p>C. 学生です</p>
                        <p>D. 医者です</p>
                    </div>
                    <button class="toggle-answer">显示答案</button>
                    <div class="answer-section">
                        <p class="answer">正确答案：C. 学生です</p>
                        <p class="explanation">对话中田中问「王さんは学生ですか」，王回答「はい、そうです」，确认他是学生。</p>
                    </div>
                </div>
            </div>
            
            <div class="exam-section listening-test">
                <h4>听力部分</h4>
                <p class="section-note">以下是听力测试相关题目，在实际考试中会听录音回答。此处可以点击文本播放音频。</p>
                
                <div class="question">
                    <p class="question-number">8.</p>
                    <p class="listening-script speech-text">はじめまして。私は山田です。中国語を勉強しています。どうぞよろしく。</p>
                    <p class="question-text">この人は何を勉強していますか。</p>
                    <div class="options">
                        <p>A. 英語</p>
                        <p>B. 中国語</p>
                        <p>C. 日本語</p>
                        <p>D. 韓国語</p>
                    </div>
                    <button class="toggle-answer">显示答案</button>
                    <div class="answer-section">
                        <p class="answer">正确答案：B. 中国語</p>
                        <p class="explanation">听力内容中说「中国語を勉強しています」，表示"我在学习中文"。</p>
                    </div>
                </div>
                
                <div class="question">
                    <p class="question-number">9.</p>
                    <p class="listening-script speech-text">すみません、あなたは李さんですか。</p>
                    <p class="question-text">この人は何と言っていますか。</p>
                    <div class="options">
                        <p>A. 询问对方是否是李先生</p>
                        <p>B. 向对方介绍自己是李先生</p>
                        <p>C. 向李先生道歉</p>
                        <p>D. 请李先生帮忙</p>
                    </div>
                    <button class="toggle-answer">显示答案</button>
                    <div class="answer-section">
                        <p class="answer">正确答案：A. 询问对方是否是李先生</p>
                        <p class="explanation">「すみません、あなたは李さんですか」表示"打扰了，请问你是李先生吗？"，是在询问对方的身份。</p>
                    </div>
                </div>
                
                <div class="question">
                    <p class="question-number">10.</p>
                    <p class="listening-script speech-text">私は森です。日本から来ました。どうぞよろしくお願いします。</p>
                    <p class="question-text">森さんはどこから来ましたか。</p>
                    <div class="options">
                        <p>A. 中国</p>
                        <p>B. 日本</p>
                        <p>C. アメリカ</p>
                        <p>D. 韓国</p>
                    </div>
                    <button class="toggle-answer">显示答案</button>
                    <div class="answer-section">
                        <p class="answer">正确答案：B. 日本</p>
                        <p class="explanation">听力内容中说「日本から来ました」，表示"我来自日本"。</p>
                    </div>
                </div>
            </div>
        </section>

        <div class="lesson-pagination">
            <div class="pagination-controls">
                <a href="index.html" class="pagination-home">目录</a>
                <span class="pagination-prev" style="visibility: hidden;">« 上一课</span>
                <span class="pagination-current">第一课</span>
                <a href="lesson2.html" class="pagination-next">第二课 »</a>
            </div>
        </div>
    </div>
    
    <!-- 备用音频面板 -->
    <div id="backupAudioPanel" class="backup-audio-panel">
        <div style="text-align: center; margin-bottom: 10px;">
            <strong>🎵 选择播放方式</strong>
            <button onclick="hideBackupPanel()" style="float: right; background: transparent; border: none; color: white; cursor: pointer;">✕</button>
        </div>
        <div id="currentTextDisplay" style="background: rgba(255,255,255,0.1); padding: 8px; border-radius: 4px; margin-bottom: 10px; text-align: center; font-weight: bold;"></div>
        <div class="backup-options">
            <button class="backup-option" onclick="playWithResponsiveVoice()">
                🎤 ResponsiveVoice<br><small>高质量语音</small>
            </button>
            <button class="backup-option" onclick="playWithVoiceRSS()">
                🔊 VoiceRSS<br><small>稳定可靠</small>
            </button>
            <button class="backup-option" onclick="playWithTTSReader()">
                📢 TTSReader<br><small>免费服务</small>
            </button>
            <button class="backup-option" onclick="playWithNaturalReaders()">
                🎵 NaturalReaders<br><small>自然发音</small>
            </button>
            <button class="backup-option" onclick="openGoogleTranslate()">
                🌐 Google翻译<br><small>最准确</small>
            </button>
            <button class="backup-option" onclick="openBingTranslator()">
                🔵 必应翻译<br><small>微软引擎</small>
            </button>
        </div>
    </div>

    <!-- 隐藏的音频加载区域 -->
    <div id="audioLoadingArea" style="display: none;">
        <iframe id="ttsIframe" class="tts-iframe"></iframe>
    </div>
    
    <script src="script.js"></script>
    <script>
        // 🎵 终极日语音频系统 V7.0 - 完全兼容版
        class UltimateJapaneseAudioSystem {
            constructor() {
                this.config = {
                    speechSupported: false,
                    japaneseVoice: null,
                    currentMethod: 'auto',
                    isInitialized: false,
                    isMobile: /Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),
                    isChrome: /Chrome/i.test(navigator.userAgent),
                    isAndroid: /Android/i.test(navigator.userAgent),
                    isIOS: /iPhone|iPad|iPod/i.test(navigator.userAgent),
                    isSafari: /Safari/i.test(navigator.userAgent) && !/Chrome/i.test(navigator.userAgent)
                };
                
                this.currentText = '';
                this.currentButton = null;
                this.audioCache = new Map();
                this.statusCheckInterval = null;
                
                // 多重在线TTS服务
                this.onlineProviders = [
                    {
                        name: 'Google TTS (直接)',
                        url: (text) => `https://translate.google.com/translate_tts?ie=UTF-8&client=tw-ob&q=${encodeURIComponent(text)}&tl=ja`,
                        priority: 1
                    },
                    {
                        name: 'ResponsiveVoice',
                        url: (text) => `https://code.responsivevoice.org/getvoice.php?t=${encodeURIComponent(text)}&tl=ja&sv=&vn=&pitch=0.5&rate=0.5&vol=1`,
                        priority: 2
                    },
                    {
                        name: 'VoiceRSS',
                        url: (text) => `https://api.voicerss.org/?key=demo&hl=ja-jp&c=MP3&f=22khz_16bit_mono&src=${encodeURIComponent(text)}`,
                        priority: 3
                    }
                ];
                
                this.externalServices = [
                    {
                        name: 'Google翻译',
                        url: (text) => `https://translate.google.com/?sl=ja&tl=zh&text=${encodeURIComponent(text)}&op=translate`,
                        icon: '🌐',
                        description: '最准确的日语发音'
                    },
                    {
                        name: '必应翻译',
                        url: (text) => `https://www.bing.com/translator/?text=${encodeURIComponent(text)}&from=ja&to=zh-Hans`,
                        icon: '🔊',
                        description: '微软语音引擎'
                    },
                    {
                        name: '有道翻译',
                        url: (text) => `https://fanyi.youdao.com/#/ja/zh/${encodeURIComponent(text)}`,
                        icon: '📱',
                        description: '国内稳定访问'
                    }
                ];
                
                this.init();
            }
            
            async init() {
                console.log('🚀 初始化终极日语音频系统 V7.0');
                console.log(`📱 设备信息: ${this.config.isMobile ? '移动设备' : '桌面设备'}`);
                console.log(`🌐 浏览器: ${this.getBrowserInfo()}`);
                
                // 显示状态面板
                this.showStatusPanel();
                
                // 初始化本地语音
                await this.initLocalSpeech();
                
                // 测试在线服务
                await this.testOnlineServices();
                
                // 绑定事件
                this.bindEvents();
                
                // 更新推荐方案
                this.updateRecommendedMethod();
                
                // 启动状态监控
                this.startStatusMonitoring();
                
                this.config.isInitialized = true;
                console.log('✅ 音频系统初始化完成');
                
                // 5秒后自动隐藏状态面板
                setTimeout(() => {
                    this.hideStatusPanel();
                }, 5000);
            }
            
            getBrowserInfo() {
                if (this.config.isChrome && this.config.isAndroid) return 'Android Chrome';
                if (this.config.isSafari && this.config.isIOS) return 'iOS Safari';
                if (this.config.isChrome) return 'Chrome';
                if (this.config.isSafari) return 'Safari';
                return '其他浏览器';
            }
            
            showStatusPanel() {
                const panel = document.getElementById('audioTestPanel');
                if (panel) {
                    panel.classList.add('show');
                    this.updateLocalStatus('检测中...', 'loading');
                    this.updateOnlineStatus('检测中...', 'loading');
                    this.updateRecommendedStatus('分析中...', 'loading');
                }
            }
            
            hideStatusPanel() {
                const panel = document.getElementById('audioTestPanel');
                if (panel) {
                    panel.classList.remove('show');
                }
            }
            
            async initLocalSpeech() {
                console.log('🔍 检测本地语音支持...');
                
                if (!('speechSynthesis' in window)) {
                    console.log('❌ 本地语音API不支持');
                    this.updateLocalStatus('不支持', 'offline');
                    return false;
                }
                
                this.config.speechSupported = true;
                this.updateLocalStatus('加载中...', 'loading');
                
                return new Promise((resolve) => {
                    const loadVoices = () => {
                        const voices = speechSynthesis.getVoices();
                        console.log(`🔍 检测到 ${voices.length} 个语音`);
                        
                        if (voices.length === 0) {
                            this.updateLocalStatus('无语音', 'offline');
                            resolve(false);
                            return;
                        }
                        
                        // 查找日语语音
                        const japaneseVoices = voices.filter(voice => {
                            const lang = voice.lang?.toLowerCase() || '';
                            const name = voice.name?.toLowerCase() || '';
                            return lang.includes('ja') || 
                                   name.includes('japanese') || 
                                   name.includes('kyoko') || 
                                   name.includes('otoya');
                        });
                        
                        if (japaneseVoices.length > 0) {
                            this.config.japaneseVoice = japaneseVoices[0];
                            console.log(`✅ 找到日语语音: ${this.config.japaneseVoice.name}`);
                            this.updateLocalStatus(`可用 (${this.config.japaneseVoice.name.substring(0, 8)})`, 'online');
                            resolve(true);
                        } else if (voices.length > 0) {
                            this.config.japaneseVoice = voices[0];
                            console.log(`⚠️ 使用默认语音: ${this.config.japaneseVoice.name}`);
                            this.updateLocalStatus(`默认语音`, 'online');
                            resolve(true);
                        } else {
                            this.updateLocalStatus('无可用语音', 'offline');
                            resolve(false);
                        }
                    };
                    
                    if (speechSynthesis.getVoices().length === 0) {
                        speechSynthesis.addEventListener('voiceschanged', loadVoices, { once: true });
                        // 超时处理
                        setTimeout(() => {
                            if (speechSynthesis.getVoices().length === 0) {
                                console.log('⏰ 语音加载超时');
                                this.updateLocalStatus('加载超时', 'offline');
                                resolve(false);
                            }
                        }, 3000);
                    } else {
                        loadVoices();
                    }
                });
            }
            
            async testOnlineServices() {
                console.log('🌐 测试在线服务...');
                this.updateOnlineStatus('测试中...', 'loading');
                
                try {
                    // 简单的网络连接测试
                    const testPromise = fetch('https://www.google.com/favicon.ico', { 
                        method: 'HEAD', 
                        mode: 'no-cors',
                        cache: 'no-cache'
                    });
                    
                    const timeoutPromise = new Promise((_, reject) => 
                        setTimeout(() => reject(new Error('timeout')), 3000)
                    );
                    
                    await Promise.race([testPromise, timeoutPromise]);
                    
                    console.log('✅ 网络连接正常');
                    this.updateOnlineStatus('可用', 'online');
                    return true;
                } catch (error) {
                    console.log('❌ 网络连接异常:', error.message);
                    this.updateOnlineStatus('网络异常', 'offline');
                    return false;
                }
            }
            
            updateRecommendedMethod() {
                let method = '手动播放';
                let status = 'offline';
                
                if (this.config.speechSupported && this.config.japaneseVoice) {
                    if (this.config.isAndroid || this.config.isIOS) {
                        method = '混合模式';
                        status = 'online';
                    } else {
                        method = '本地语音';
                        status = 'online';
                    }
                } else {
                    method = '在线服务';
                    status = 'loading';
                }
                
                this.updateRecommendedStatus(method, status);
            }
            
            bindEvents() {
                // 绑定音频按钮
                document.querySelectorAll('.audio-button').forEach(button => {
                    const text = button.getAttribute('data-text') || 
                               button.getAttribute('onclick')?.match(/'([^']+)'/)?.[1];
                    
                    if (text) {
                        // 移除旧的onclick
                        button.removeAttribute('onclick');
                        
                        // 添加新的事件监听器
                        button.addEventListener('click', (e) => {
                            e.preventDefault();
                            this.playAudio(text, button);
                        });
                    }
                });
                
                // 用户交互激活
                document.addEventListener('click', this.activateAudioContext.bind(this), { once: true });
                document.addEventListener('touchstart', this.activateAudioContext.bind(this), { once: true });
            }
            
            activateAudioContext() {
                if (this.config.speechSupported) {
                    try {
                        const testUtterance = new SpeechSynthesisUtterance('');
                        testUtterance.volume = 0;
                        speechSynthesis.speak(testUtterance);
                        console.log('🎵 音频上下文已激活');
                    } catch (e) {
                        console.log('音频上下文激活跳过');
                    }
                }
            }
            
            async playAudio(text, button) {
                console.log(`🎵 播放请求: "${text}"`);
                this.currentText = text;
                this.currentButton = button;
                
                // 重置按钮状态
                this.resetAllButtons();
                if (button) {
                    button.classList.add('loading');
                    button.textContent = '⏳';
                }
                
                // 选择播放策略
                const method = document.getElementById('audioMethod')?.value || 'auto';
                
                switch (method) {
                    case 'local':
                        await this.playLocalAudio(text, button);
                        break;
                    case 'online':
                        await this.playOnlineAudio(text, button);
                        break;
                    case 'manual':
                        this.showBackupOptions(text, button);
                        break;
                    case 'guide':
                        this.showPronunciationGuide(text, button);
                        break;
                    case 'auto':
                    default:
                        await this.playAutoAudio(text, button);
                        break;
                }
            }
            
            async playAutoAudio(text, button) {
                console.log('🤖 智能播放模式');
                
                // 移动设备优先策略
                if (this.config.isMobile) {
                    // 先尝试在线服务
                    const onlineSuccess = await this.playOnlineAudio(text, button);
                    if (!onlineSuccess) {
                        // 再尝试本地语音
                        const localSuccess = await this.playLocalAudio(text, button);
                        if (!localSuccess) {
                            // 显示备用选项
                            this.showBackupOptions(text, button);
                        }
                    }
                } else {
                    // 桌面设备优先本地语音
                    const localSuccess = await this.playLocalAudio(text, button);
                    if (!localSuccess) {
                        const onlineSuccess = await this.playOnlineAudio(text, button);
                        if (!onlineSuccess) {
                            this.showBackupOptions(text, button);
                        }
                    }
                }
            }
            
            async playLocalAudio(text, button) {
                if (!this.config.speechSupported || !this.config.japaneseVoice) {
                    console.log('❌ 本地语音不可用');
                    return false;
                }
                
                return new Promise((resolve) => {
                    try {
                        speechSynthesis.cancel();
                        
                        const utterance = new SpeechSynthesisUtterance(text);
                        utterance.voice = this.config.japaneseVoice;
                        utterance.lang = 'ja-JP';
                        utterance.rate = parseFloat(document.getElementById('speechRate')?.value || 0.8);
                        utterance.pitch = 1.0;
                        utterance.volume = 1.0;
                        
                        utterance.onstart = () => {
                            console.log('▶️ 本地播放开始');
                            if (button) {
                                button.classList.remove('loading');
                                button.classList.add('playing');
                                button.textContent = '▶️';
                            }
                        };
                        
                        utterance.onend = () => {
                            console.log('⏹️ 本地播放结束');
                            this.resetButton(button);
                            resolve(true);
                        };
                        
                        utterance.onerror = (event) => {
                            console.error(`❌ 本地播放错误: ${event.error}`);
                            this.resetButton(button);
                            resolve(false);
                        };
                        
                        speechSynthesis.speak(utterance);
                        
                    } catch (error) {
                        console.error('❌ 本地播放异常:', error);
                        this.resetButton(button);
                        resolve(false);
                    }
                });
            }
            
            async playOnlineAudio(text, button) {
                console.log('🌐 尝试在线播放');
                
                // 尝试多个在线服务
                for (const provider of this.onlineProviders) {
                    try {
                        console.log(`尝试 ${provider.name}...`);
                        const success = await this.tryProvider(provider, text, button);
                        if (success) {
                            console.log(`✅ ${provider.name} 播放成功`);
                            return true;
                        }
                    } catch (error) {
                        console.log(`❌ ${provider.name} 失败:`, error);
                    }
                }
                
                console.log('❌ 所有在线服务都失败');
                return false;
            }
            
            async tryProvider(provider, text, button) {
                return new Promise((resolve) => {
                    try {
                        const audioUrl = provider.url(text);
                        const audio = new Audio();
                        
                        // 设置超时
                        const timeout = setTimeout(() => {
                            resolve(false);
                        }, 5000);
                        
                        audio.oncanplaythrough = () => {
                            clearTimeout(timeout);
                            if (button) {
                                button.classList.remove('loading');
                                button.classList.add('playing');
                                button.textContent = '▶️';
                            }
                            
                            audio.play()
                                .then(() => resolve(true))
                                .catch(() => resolve(false));
                        };
                        
                        audio.onended = () => {
                            this.resetButton(button);
                        };
                        
                        audio.onerror = () => {
                            clearTimeout(timeout);
                            resolve(false);
                        };
                        
                        // 尝试加载音频
                        audio.crossOrigin = 'anonymous';
                        audio.src = audioUrl;
                        audio.load();
                        
                    } catch (error) {
                        resolve(false);
                    }
                });
            }
            
            showBackupOptions(text, button) {
                console.log('📋 显示备用选项');
                this.currentText = text;
                
                if (button) {
                    button.classList.remove('loading');
                    button.classList.add('error');
                    button.textContent = '🔗';
                }
                
                const panel = document.getElementById('backupAudioPanel');
                const textDisplay = document.getElementById('currentTextDisplay');
                
                if (panel && textDisplay) {
                    textDisplay.textContent = `日语: ${text}`;
                    panel.classList.add('show');
                }
            }
            
            // 状态更新方法
            updateLocalStatus(message, type) {
                const statusEl = document.getElementById('localStatus');
                if (statusEl) {
                    statusEl.innerHTML = `<span class="status-indicator ${type}"></span>${message}`;
                }
            }
            
            updateOnlineStatus(message, type) {
                const statusEl = document.getElementById('onlineStatus');
                if (statusEl) {
                    statusEl.innerHTML = `<span class="status-indicator ${type}"></span>${message}`;
                }
            }
            
            updateRecommendedStatus(message, type) {
                const statusEl = document.getElementById('recommendedMethod');
                if (statusEl) {
                    statusEl.innerHTML = `<span class="status-indicator ${type}"></span>${message}`;
                }
            }
            
            updateMainStatus(message, type = 'loading') {
                const statusEl = document.getElementById('currentAudioStatus');
                if (statusEl) {
                    statusEl.textContent = message;
                    statusEl.className = `audio-status ${type}`;
                }
            }
            
            // 按钮控制
            resetButton(button) {
                if (button) {
                    button.classList.remove('loading', 'playing', 'error', 'success');
                    button.textContent = '🔊';
                }
            }
            
            resetAllButtons() {
                document.querySelectorAll('.audio-button').forEach(button => {
                    this.resetButton(button);
                });
            }
            
            // 状态监控
            startStatusMonitoring() {
                // 每5秒检查一次状态
                this.statusCheckInterval = setInterval(() => {
                    this.updateMainStatus(this.getOverallStatus(), this.getOverallStatusType());
                }, 5000);
            }
            
            getOverallStatus() {
                if (this.config.speechSupported && this.config.japaneseVoice) {
                    return '音频系统就绪 - 多重播放方案可用';
                } else {
                    return '仅支持在线播放和外部链接';
                }
            }
            
            getOverallStatusType() {
                if (this.config.speechSupported && this.config.japaneseVoice) {
                    return 'online';
                } else {
                    return 'loading';
                }
            }
            
            // 外部方法
            openExternalService(serviceName) {
                const service = this.externalServices.find(s => s.name === serviceName);
                if (service && this.currentText) {
                    const url = service.url(this.currentText);
                    window.open(url, '_blank', 'noopener,noreferrer');
                    console.log(`🔗 打开外部服务: ${serviceName}`);
                    this.hideBackupPanel();
                }
            }
            
            hideBackupPanel() {
                const panel = document.getElementById('backupAudioPanel');
                if (panel) {
                    panel.classList.remove('show');
                }
            }
            
            showPronunciationGuide(text, button) {
                // 显示发音指导的逻辑
                console.log(`📖 显示发音指导: ${text}`);
                if (button) {
                    button.classList.remove('loading');
                    button.classList.add('success');
                    button.textContent = '📖';
                }
                // 这里可以添加显示发音指导面板的代码
            }
        }
        
        // 全局实例
        let audioSystem;
        
        // 全局函数
        function testAudioSystem() {
            console.log('🧪 手动测试音频系统');
            if (audioSystem) {
                audioSystem.showStatusPanel();
                setTimeout(() => {
                    audioSystem.playAudio('テスト', null);
                }, 1000);
            }
        }
        
        function showAudioHelp() {
            const helpText = `🎵 终极日语音频系统 V7.0

🚀 系统特性:
• 智能设备检测和适配
• 多重在线TTS服务
• 完善的备用方案
• 实时状态监控

📱 设备兼容性:
• Android Chrome: ✅ 完美支持
• iOS Safari: ✅ 完美支持
• 桌面浏览器: ✅ 完美支持

🔧 播放方式:
• 智能选择: 自动选择最佳方案
• 本地语音: 设备内置TTS
• 在线语音: 多个TTS服务
• 手动播放: 外部翻译网站
• 发音指导: 详细发音说明

💡 使用建议:
1. 首次使用建议点击"测试音频"
2. 如遇问题可切换播放方式
3. 移动设备建议连接WiFi`;
        
            alert(helpText);
        }
        
        function hideBackupPanel() {
            audioSystem?.hideBackupPanel();
        }
        
        function playWithResponsiveVoice() {
            audioSystem?.openExternalService('ResponsiveVoice');
        }
        
        function playWithVoiceRSS() {
            audioSystem?.openExternalService('VoiceRSS');
        }
        
        function playWithTTSReader() {
            audioSystem?.openExternalService('TTSReader');
        }
        
        function playWithNaturalReaders() {
            audioSystem?.openExternalService('NaturalReaders');
        }
        
        function openGoogleTranslate() {
            audioSystem?.openExternalService('Google翻译');
        }
        
        function openBingTranslator() {
            audioSystem?.openExternalService('必应翻译');
        }
        
        // 页面初始化
        document.addEventListener('DOMContentLoaded', function() {
            console.log('🚀 页面加载完成，初始化终极音频系统');
            
            // 延迟初始化，确保DOM完全加载
            setTimeout(() => {
                audioSystem = new UltimateJapaneseAudioSystem();
            }, 100);
            
            // 初始化其他功能
            updatePagination();
            
            console.log('✅ 页面初始化完成');
        });
        
        // 自动更新页码导航
        function updatePagination() {
            // 获取当前页面文件名
            const currentPath = window.location.pathname;
            const currentPage = currentPath.substring(currentPath.lastIndexOf('/') + 1);
            
            // 提取当前课程编号
            const currentLessonMatch = currentPage.match(/lesson(\d+)\.html/);
            if (!currentLessonMatch) return;
            
            const currentLessonNum = parseInt(currentLessonMatch[1]);
            const prevLessonNum = currentLessonNum - 1;
            const nextLessonNum = currentLessonNum + 1;
            
            // 更新导航链接
            const prevLink = document.querySelector('.nav-prev');
            const nextLink = document.querySelector('.nav-next');
            const paginationPrev = document.querySelector('.pagination-prev');
            const paginationNext = document.querySelector('.pagination-next');
            const paginationCurrent = document.querySelector('.pagination-current');
            
            // 检查前一课是否存在
            if (prevLessonNum >= 1) {
                const prevUrl = `lesson${prevLessonNum}.html`;
                prevLink.href = prevUrl;
                prevLink.style.visibility = 'visible';
                
                paginationPrev.href = prevUrl;
                paginationPrev.textContent = `« 第${toChineseNumber(prevLessonNum)}课`;
                paginationPrev.style.visibility = 'visible';
            } else {
                prevLink.style.visibility = 'hidden';
                paginationPrev.style.visibility = 'hidden';
            }
            
            // 总是更新当前课程编号
            paginationCurrent.textContent = `第${toChineseNumber(currentLessonNum)}课`;
            
            // 从当前DOM中检测已知的课程链接
            const courseLinks = detectExistingCourseLinks();
            const maxLessons = Math.max(...courseLinks, 6); // 至少支持6课
            
            if (nextLessonNum <= maxLessons) {
                const nextUrl = `lesson${nextLessonNum}.html`;
                nextLink.href = nextUrl;
                nextLink.style.visibility = 'visible';
                
                paginationNext.href = nextUrl;
                paginationNext.textContent = `第${toChineseNumber(nextLessonNum)}课 »`;
                paginationNext.style.visibility = 'visible';
            } else {
                nextLink.style.visibility = 'hidden';
                paginationNext.style.visibility = 'hidden';
            }
        }
        
        // 从当前DOM中检测已知的课程链接
        function detectExistingCourseLinks() {
            const links = document.querySelectorAll('a[href^="lesson"]');
            const courseNumbers = [];
            
            links.forEach(link => {
                const match = link.getAttribute('href').match(/lesson(\d+)\.html/);
                if (match && match[1]) {
                    courseNumbers.push(parseInt(match[1]));
                }
            });
            
            return courseNumbers.length > 0 ? courseNumbers : [6]; // 默认至少6课
        }
        
        function toChineseNumber(num) {
            // 简单的数字转中文数字，适用于课程编号
            const chineseNumbers = ['零', '一', '二', '三', '四', '五', '六', '七', '八', '九', '十'];
            if (num <= 10) return chineseNumbers[num];
            if (num < 20) return '十' + (num > 10 ? chineseNumbers[num - 10] : '');
            const tens = Math.floor(num / 10);
            const ones = num % 10;
            return chineseNumbers[tens] + '十' + (ones > 0 ? chineseNumbers[ones] : '');
        }
    </script>
</body>
</html>
